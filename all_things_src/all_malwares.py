from attackcti import attack_client
import csv


def all_malwares():
    filename = "malwares.csv"
    fields = ["Name", "Description", "URL"]
    rows = []
    lift = attack_client()
    all_enterprise = lift.get_enterprise_malware()
    for i in range(1, len(all_enterprise)):
        try:
            name = all_enterprise[i]["name"]
            description = all_enterprise[i]["description"]
            url = all_enterprise[i]["external_references"][0]["url"]
            platform = all_enterprise[i]["x_mitre_platforms"]
            # print(f"Name: {name}\nDescription: {description}\nURL: {url}\n")
            rows.append([name, description, url, platform])
        except Exception as err:
            name = err
            description = err
            url = err
            platform = err
    with open(filename, 'w', encoding="utf-8") as csvfile:
        csvwriter = csv.writer(csvfile)
        csvwriter.writerow(fields)
        csvwriter.writerows(rows)

